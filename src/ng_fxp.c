#include "ng_inner.h"

/* see ng_inner.h */
uint64_t
inner_fxr_div(uint64_t x, uint64_t y)
{
	/*
	 * Get absolute values and signs. From now on, we can suppose
	 * that x and y fit on 63 bits (we ignore edge conditions).
	 */
	uint64_t sx = x >> 63;
	x = (x ^ -sx) + sx;
	uint64_t sy = y >> 63;
	y = (y ^ -sy) + sy;

	/*
	 * Do a bit by bit division, assuming that the quotient fits.
	 * The numerator starts at x*2^31, and is shifted one bit a time.
	 */
	uint64_t q = 0;
	uint64_t num = x >> 31;
	for (int i = 63; i >= 33; i --) {
		uint64_t b = 1 - ((num - y) >> 63);
		q |= b << i;
		num -= y & -b;
		num <<= 1;
		num |= (x >> (i - 33)) & 1;
	}
	for (int i = 32; i >= 0; i --) {
		uint64_t b = 1 - ((num - y) >> 63);
		q |= b << i;
		num -= y & -b;
		num <<= 1;
	}

	/*
	 * Rounding: if the remainder is at least y/2 (scaled), we add
	 * 2^(-32) to the quotient.
	 */
	uint64_t b = 1 - ((num - y) >> 63);
	q += b;

	/*
	 * Sign management: if the original x and y had different signs,
	 * then we must negate the quotient.
	 */
	sx ^= sy;
	q = (q ^ -sx) + sx;

	return q;
}

#if NTRUGEN_AVX2
/* see inner.h */
TARGET_AVX2
__m256i
fxr_div_x4(__m256i yn, __m256i yd)
{
	/*
	 * Get absolute values and signs. From now on, we can suppose
	 * that n and d fit on 63 bits (we ignore edge conditions).
	 */
	__m256i ysn = _mm256_sub_epi64(_mm256_setzero_si256(),
		_mm256_srli_epi64(yn, 63));
	__m256i ysd = _mm256_sub_epi64(_mm256_setzero_si256(),
		_mm256_srli_epi64(yd, 63));
	yn = _mm256_sub_epi64(_mm256_xor_si256(yn, ysn), ysn);
	yd = _mm256_sub_epi64(_mm256_xor_si256(yd, ysd), ysd);

	/*
	 * Do a bit by bit division, assuming that the quotient fits.
	 * The numerator starts at n*2^31, and is shifted one bit a time.
	 */
	__m256i yq = _mm256_setzero_si256();
	__m256i ynum = _mm256_srli_epi64(yn, 31);
	__m256i y1 = _mm256_set1_epi64x(1);
	for (int i = 63; i >= 33; i --) {
		__m256i yb = _mm256_srli_epi64(_mm256_sub_epi64(ynum, yd), 63);
		__m256i yc = _mm256_sub_epi64(yb, y1);
		yq = _mm256_add_epi64(yq, yq);
		yq = _mm256_sub_epi64(yq, yc);
		ynum = _mm256_sub_epi64(ynum, _mm256_and_si256(yc, yd));
		ynum = _mm256_add_epi64(ynum, ynum);
		ynum = _mm256_or_si256(ynum,
			_mm256_and_si256(_mm256_srli_epi64(yn, 30), y1));
		yn = _mm256_add_epi64(yn, yn);
	}
	for (int i = 32; i >= 0; i --) {
		__m256i yb = _mm256_srli_epi64(_mm256_sub_epi64(ynum, yd), 63);
		__m256i yc = _mm256_sub_epi64(yb, y1);
		yq = _mm256_add_epi64(yq, yq);
		yq = _mm256_sub_epi64(yq, yc);
		ynum = _mm256_sub_epi64(ynum, _mm256_and_si256(yc, yd));
		ynum = _mm256_add_epi64(ynum, ynum);
	}

	/*
	 * Rounding: if the remainder is at least d/2 (scaled), we add
	 * 2^(-32) to the quotient.
	 */
	__m256i yb0 = _mm256_srli_epi64(_mm256_sub_epi64(ynum, yd), 63);
	yq = _mm256_add_epi64(_mm256_xor_si256(y1, yb0), yq);

	/*
	 * Sign management: if the original yn and yd had different signs,
	 * then we must negate the quotient.
	 */
	ysn = _mm256_xor_si256(ysn, ysd);
	yq = _mm256_sub_epi64(_mm256_xor_si256(yq, ysn), ysn);

	return yq;
}
#endif // NTRUGEN_AVX2

/*
 * Primitive 2048-th roots of unity, in the proper order for FFT.
 */
static const fxc GM_TAB[1024] = {
	FXC(          4294967296ull,                    0ull),
	FXC(                   0ull,           4294967296ull),
	FXC(          3037000500ull,           3037000500ull),
	FXC(18446744070672551116ull,           3037000500ull),
	FXC(          3968032378ull,           1643612827ull),
	FXC(18446744072065938789ull,           3968032378ull),
	FXC(          1643612827ull,           3968032378ull),
	FXC(18446744069741519238ull,           1643612827ull),
	FXC(          4212440704ull,            837906553ull),
	FXC(18446744072871645063ull,           4212440704ull),
	FXC(          2386155981ull,           3571134792ull),
	FXC(18446744070138416824ull,           2386155981ull),
	FXC(          3571134792ull,           2386155981ull),
	FXC(18446744071323395635ull,           3571134792ull),
	FXC(           837906553ull,           4212440704ull),
	FXC(18446744069497110912ull,            837906553ull),
	FXC(          4274285855ull,            420980412ull),
	FXC(18446744073288571204ull,           4274285855ull),
	FXC(          2724698408ull,           3320054617ull),
	FXC(18446744070389496999ull,           2724698408ull),
	FXC(          3787822988ull,           2024633568ull),
	FXC(18446744071684918048ull,           3787822988ull),
	FXC(          1246763195ull,           4110027446ull),
	FXC(18446744069599524170ull,           1246763195ull),
	FXC(          4110027446ull,           1246763195ull),
	FXC(18446744072462788421ull,           4110027446ull),
	FXC(          2024633568ull,           3787822988ull),
	FXC(18446744069921728628ull,           2024633568ull),
	FXC(          3320054617ull,           2724698408ull),
	FXC(18446744070984853208ull,           3320054617ull),
	FXC(           420980412ull,           4274285855ull),
	FXC(18446744069435265761ull,            420980412ull),
	FXC(          4289793820ull,            210744057ull),
	FXC(18446744073498807559ull,           4289793820ull),
	FXC(          2884323748ull,           3182360851ull),
	FXC(18446744070527190765ull,           2884323748ull),
	FXC(          3882604450ull,           1836335144ull),
	FXC(18446744071873216472ull,           3882604450ull),
	FXC(          1446930903ull,           4043900968ull),
	FXC(18446744069665650648ull,           1446930903ull),
	FXC(          4166252509ull,           1043591926ull),
	FXC(18446744072665959690ull,           4166252509ull),
	FXC(          2208054473ull,           3683916329ull),
	FXC(18446744070025635287ull,           2208054473ull),
	FXC(          3449750080ull,           2558509031ull),
	FXC(18446744071151042585ull,           3449750080ull),
	FXC(           630202589ull,           4248480760ull),
	FXC(18446744069461070856ull,            630202589ull),
	FXC(          4248480760ull,            630202589ull),
	FXC(18446744073079349027ull,           4248480760ull),
	FXC(          2558509031ull,           3449750080ull),
	FXC(18446744070259801536ull,           2558509031ull),
	FXC(          3683916329ull,           2208054473ull),
	FXC(18446744071501497143ull,           3683916329ull),
	FXC(          1043591926ull,           4166252509ull),
	FXC(18446744069543299107ull,           1043591926ull),
	FXC(          4043900968ull,           1446930903ull),
	FXC(18446744072262620713ull,           4043900968ull),
	FXC(          1836335144ull,           3882604450ull),
	FXC(18446744069826947166ull,           1836335144ull),
	FXC(          3182360851ull,           2884323748ull),
	FXC(18446744070825227868ull,           3182360851ull),
	FXC(           210744057ull,           4289793820ull),
	FXC(18446744069419757796ull,            210744057ull),
	FXC(          4293673732ull,            105403774ull),
	FXC(18446744073604147842ull,           4293673732ull),
	FXC(          2961554089ull,           3110617535ull),
	FXC(18446744070598934081ull,           2961554089ull),
	FXC(          3926501002ull,           1740498191ull),
	FXC(18446744071969053425ull,           3926501002ull),
	FXC(          1545737412ull,           4007173558ull),
	FXC(18446744069702378058ull,           1545737412ull),
	FXC(          4190608739ull,            941032661ull),
	FXC(18446744072768518955ull,           4190608739ull),
	FXC(          2297797281ull,           3628618433ull),
	FXC(18446744070080933183ull,           2297797281ull),
	FXC(          3511500034ull,           2473077351ull),
	FXC(18446744071236474265ull,           3511500034ull),
	FXC(           734275721ull,           4231735252ull),
	FXC(18446744069477816364ull,            734275721ull),
	FXC(          4262667143ull,            525749847ull),
	FXC(18446744073183801769ull,           4262667143ull),
	FXC(          2642399561ull,           3385922125ull),
	FXC(18446744070323629491ull,           2642399561ull),
	FXC(          3736995171ull,           2116981616ull),
	FXC(18446744071592570000ull,           3736995171ull),
	FXC(          1145522571ull,           4139386683ull),
	FXC(18446744069570164933ull,           1145522571ull),
	FXC(          4078192482ull,           1347252816ull),
	FXC(18446744072362298800ull,           4078192482ull),
	FXC(          1931065957ull,           3836369162ull),
	FXC(18446744069873182454ull,           1931065957ull),
	FXC(          3252187232ull,           2805355999ull),
	FXC(18446744070904195617ull,           3252187232ull),
	FXC(           315957395ull,           4283329896ull),
	FXC(18446744069426221720ull,            315957395ull),
	FXC(          4283329896ull,            315957395ull),
	FXC(18446744073393594221ull,           4283329896ull),
	FXC(          2805355999ull,           3252187232ull),
	FXC(18446744070457364384ull,           2805355999ull),
	FXC(          3836369162ull,           1931065957ull),
	FXC(18446744071778485659ull,           3836369162ull),
	FXC(          1347252816ull,           4078192482ull),
	FXC(18446744069631359134ull,           1347252816ull),
	FXC(          4139386683ull,           1145522571ull),
	FXC(18446744072564029045ull,           4139386683ull),
	FXC(          2116981616ull,           3736995171ull),
	FXC(18446744069972556445ull,           2116981616ull),
	FXC(          3385922125ull,           2642399561ull),
	FXC(18446744071067152055ull,           3385922125ull),
	FXC(           525749847ull,           4262667143ull),
	FXC(18446744069446884473ull,            525749847ull),
	FXC(          4231735252ull,            734275721ull),
	FXC(18446744072975275895ull,           4231735252ull),
	FXC(          2473077351ull,           3511500034ull),
	FXC(18446744070198051582ull,           2473077351ull),
	FXC(          3628618433ull,           2297797281ull),
	FXC(18446744071411754335ull,           3628618433ull),
	FXC(           941032661ull,           4190608739ull),
	FXC(18446744069518942877ull,            941032661ull),
	FXC(          4007173558ull,           1545737412ull),
	FXC(18446744072163814204ull,           4007173558ull),
	FXC(          1740498191ull,           3926501002ull),
	FXC(18446744069783050614ull,           1740498191ull),
	FXC(          3110617535ull,           2961554089ull),
	FXC(18446744070747997527ull,           3110617535ull),
	FXC(           105403774ull,           4293673732ull),
	FXC(18446744069415877884ull,            105403774ull),
	FXC(          4294643893ull,             52705856ull),
	FXC(18446744073656845760ull,           4294643893ull),
	FXC(          2999503152ull,           3074040487ull),
	FXC(18446744070635511129ull,           2999503152ull),
	FXC(          3947563934ull,           1692182927ull),
	FXC(18446744072017368689ull,           3947563934ull),
	FXC(          1594795204ull,           3987903250ull),
	FXC(18446744069721648366ull,           1594795204ull),
	FXC(          4201841112ull,            889536587ull),
	FXC(18446744072820015029ull,           4201841112ull),
	FXC(          2342152991ull,           3600147697ull),
	FXC(18446744070109403919ull,           2342152991ull),
	FXC(          3541584088ull,           2429799626ull),
	FXC(18446744071279751990ull,           3541584088ull),
	FXC(           786150333ull,           4222405917ull),
	FXC(18446744069487145699ull,            786150333ull),
	FXC(          4268797931ull,            473400776ull),
	FXC(18446744073236150840ull,           4268797931ull),
	FXC(          2683751066ull,           3353240863ull),
	FXC(18446744070356310753ull,           2683751066ull),
	FXC(          3762692404ull,           2070963532ull),
	FXC(18446744071638588084ull,           3762692404ull),
	FXC(          1196232957ull,           4125017671ull),
	FXC(18446744069584533945ull,           1196232957ull),
	FXC(          4094418266ull,           1297105676ull),
	FXC(18446744072412445940ull,           4094418266ull),
	FXC(          1977998702ull,           3812383140ull),
	FXC(18446744069897168476ull,           1977998702ull),
	FXC(          3286368382ull,           2765235421ull),
	FXC(18446744070944316195ull,           3286368382ull),
	FXC(           368496651ull,           4279130086ull),
	FXC(18446744069430421530ull,            368496651ull),
	FXC(          4286884652ull,            263370557ull),
	FXC(18446744073446181059ull,           4286884652ull),
	FXC(          2845054101ull,           3217516315ull),
	FXC(18446744070492035301ull,           2845054101ull),
	FXC(          3859777440ull,           1883842400ull),
	FXC(18446744071825709216ull,           3859777440ull),
	FXC(          1397197066ull,           4061352537ull),
	FXC(18446744069648199079ull,           1397197066ull),
	FXC(          4153132319ull,           1094639673ull),
	FXC(18446744072614911943ull,           4153132319ull),
	FXC(          2162680890ull,           3710735162ull),
	FXC(18446744069998816454ull,           2162680890ull),
	FXC(          3418093478ull,           2600650120ull),
	FXC(18446744071108901496ull,           3418093478ull),
	FXC(           578019742ull,           4255894413ull),
	FXC(18446744069453657203ull,            578019742ull),
	FXC(          4240427302ull,            682290530ull),
	FXC(18446744073027261086ull,           4240427302ull),
	FXC(          2515982640ull,           3480887161ull),
	FXC(18446744070228664455ull,           2515982640ull),
	FXC(          3656542712ull,           2253095531ull),
	FXC(18446744071456456085ull,           3656542712ull),
	FXC(           992387019ull,           4178745276ull),
	FXC(18446744069530806340ull,            992387019ull),
	FXC(          4025840401ull,           1496446837ull),
	FXC(18446744072213104779ull,           4025840401ull),
	FXC(          1788551342ull,           3904846754ull),
	FXC(18446744069804704862ull,           1788551342ull),
	FXC(          3146726136ull,           2923159027ull),
	FXC(18446744070786392589ull,           3146726136ull),
	FXC(           158085819ull,           4292056960ull),
	FXC(18446744069417494656ull,            158085819ull),
	FXC(          4292056960ull,            158085819ull),
	FXC(18446744073551465797ull,           4292056960ull),
	FXC(          2923159027ull,           3146726136ull),
	FXC(18446744070562825480ull,           2923159027ull),
	FXC(          3904846754ull,           1788551342ull),
	FXC(18446744071921000274ull,           3904846754ull),
	FXC(          1496446837ull,           4025840401ull),
	FXC(18446744069683711215ull,           1496446837ull),
	FXC(          4178745276ull,            992387019ull),
	FXC(18446744072717164597ull,           4178745276ull),
	FXC(          2253095531ull,           3656542712ull),
	FXC(18446744070053008904ull,           2253095531ull),
	FXC(          3480887161ull,           2515982640ull),
	FXC(18446744071193568976ull,           3480887161ull),
	FXC(           682290530ull,           4240427302ull),
	FXC(18446744069469124314ull,            682290530ull),
	FXC(          4255894413ull,            578019742ull),
	FXC(18446744073131531874ull,           4255894413ull),
	FXC(          2600650120ull,           3418093478ull),
	FXC(18446744070291458138ull,           2600650120ull),
	FXC(          3710735162ull,           2162680890ull),
	FXC(18446744071546870726ull,           3710735162ull),
	FXC(          1094639673ull,           4153132319ull),
	FXC(18446744069556419297ull,           1094639673ull),
	FXC(          4061352537ull,           1397197066ull),
	FXC(18446744072312354550ull,           4061352537ull),
	FXC(          1883842400ull,           3859777440ull),
	FXC(18446744069849774176ull,           1883842400ull),
	FXC(          3217516315ull,           2845054101ull),
	FXC(18446744070864497515ull,           3217516315ull),
	FXC(           263370557ull,           4286884652ull),
	FXC(18446744069422666964ull,            263370557ull),
	FXC(          4279130086ull,            368496651ull),
	FXC(18446744073341054965ull,           4279130086ull),
	FXC(          2765235421ull,           3286368382ull),
	FXC(18446744070423183234ull,           2765235421ull),
	FXC(          3812383140ull,           1977998702ull),
	FXC(18446744071731552914ull,           3812383140ull),
	FXC(          1297105676ull,           4094418266ull),
	FXC(18446744069615133350ull,           1297105676ull),
	FXC(          4125017671ull,           1196232957ull),
	FXC(18446744072513318659ull,           4125017671ull),
	FXC(          2070963532ull,           3762692404ull),
	FXC(18446744069946859212ull,           2070963532ull),
	FXC(          3353240863ull,           2683751066ull),
	FXC(18446744071025800550ull,           3353240863ull),
	FXC(           473400776ull,           4268797931ull),
	FXC(18446744069440753685ull,            473400776ull),
	FXC(          4222405917ull,            786150333ull),
	FXC(18446744072923401283ull,           4222405917ull),
	FXC(          2429799626ull,           3541584088ull),
	FXC(18446744070167967528ull,           2429799626ull),
	FXC(          3600147697ull,           2342152991ull),
	FXC(18446744071367398625ull,           3600147697ull),
	FXC(           889536587ull,           4201841112ull),
	FXC(18446744069507710504ull,            889536587ull),
	FXC(          3987903250ull,           1594795204ull),
	FXC(18446744072114756412ull,           3987903250ull),
	FXC(          1692182927ull,           3947563934ull),
	FXC(18446744069761987682ull,           1692182927ull),
	FXC(          3074040487ull,           2999503152ull),
	FXC(18446744070710048464ull,           3074040487ull),
	FXC(            52705856ull,           4294643893ull),
	FXC(18446744069414907723ull,             52705856ull),
	FXC(          4294886444ull,             26353424ull),
	FXC(18446744073683198192ull,           4294886444ull),
	FXC(          3018308645ull,           3055578014ull),
	FXC(18446744070653973602ull,           3018308645ull),
	FXC(          3957872662ull,           1667929275ull),
	FXC(18446744072041622341ull,           3957872662ull),
	FXC(          1619234497ull,           3978042699ull),
	FXC(18446744069731508917ull,           1619234497ull),
	FXC(          4207220108ull,            863737830ull),
	FXC(18446744072845813786ull,           4207220108ull),
	FXC(          2364198992ull,           3585708745ull),
	FXC(18446744070123842871ull,           2364198992ull),
	FXC(          3556426389ull,           2408023134ull),
	FXC(18446744071301528482ull,           3556426389ull),
	FXC(           812043729ull,           4217502704ull),
	FXC(18446744069492048912ull,            812043729ull),
	FXC(          4271622305ull,            447199012ull),
	FXC(18446744073262352604ull,           4271622305ull),
	FXC(          2704275644ull,           3336710553ull),
	FXC(18446744070372841063ull,           2704275644ull),
	FXC(          3775328765ull,           2047837100ull),
	FXC(18446744071661714516ull,           3775328765ull),
	FXC(          1221521071ull,           4117600071ull),
	FXC(18446744069591951545ull,           1221521071ull),
	FXC(          4102300081ull,           1271958380ull),
	FXC(18446744072437593236ull,           4102300081ull),
	FXC(          2001353810ull,           3800174601ull),
	FXC(18446744069909377015ull,           2001353810ull),
	FXC(          3303273682ull,           2745018589ull),
	FXC(18446744070964533027ull,           3303273682ull),
	FXC(           394745962ull,           4276788480ull),
	FXC(18446744069432763136ull,            394745962ull),
	FXC(          4288419964ull,            237061769ull),
	FXC(18446744073472489847ull,           4288419964ull),
	FXC(          2864742853ull,           3199998822ull),
	FXC(18446744070509552794ull,           2864742853ull),
	FXC(          3871263820ull,           1860123788ull),
	FXC(18446744071849427828ull,           3871263820ull),
	FXC(          1422090755ull,           4052703044ull),
	FXC(18446744069656848572ull,           1422090755ull),
	FXC(          4159770720ull,           1069135926ull),
	FXC(18446744072640415690ull,           4159770720ull),
	FXC(          2185408821ull,           3697395348ull),
	FXC(18446744070012156268ull,           2185408821ull),
	FXC(          3433986423ull,           2579628136ull),
	FXC(18446744071129923480ull,           3433986423ull),
	FXC(           604122538ull,           4252267634ull),
	FXC(18446744069457283982ull,            604122538ull),
	FXC(          4244533933ull,            656258914ull),
	FXC(18446744073053292702ull,           4244533933ull),
	FXC(          2537293599ull,           3465383855ull),
	FXC(18446744070244167761ull,           2537293599ull),
	FXC(          3670298613ull,           2230616993ull),
	FXC(18446744071478934623ull,           3670298613ull),
	FXC(          1018008636ull,           4172577440ull),
	FXC(18446744069536974176ull,           1018008636ull),
	FXC(          4034946641ull,           1471716574ull),
	FXC(18446744072237835042ull,           4034946641ull),
	FXC(          1812477362ull,           3893798902ull),
	FXC(18446744069815752714ull,           1812477362ull),
	FXC(          3164603066ull,           2903796051ull),
	FXC(18446744070805755565ull,           3164603066ull),
	FXC(           184418409ull,           4291006167ull),
	FXC(18446744069418545449ull,            184418409ull),
	FXC(          4292946160ull,            131747276ull),
	FXC(18446744073577804340ull,           4292946160ull),
	FXC(          2942411948ull,           3128730733ull),
	FXC(18446744070580820883ull,           2942411948ull),
	FXC(          3915747591ull,           1764557983ull),
	FXC(18446744071944993633ull,           3915747591ull),
	FXC(          1521120759ull,           4016582591ull),
	FXC(18446744069692969025ull,           1521120759ull),
	FXC(          4184755784ull,            966728038ull),
	FXC(18446744072742823578ull,           4184755784ull),
	FXC(          2275489241ull,           3642649144ull),
	FXC(18446744070066902472ull,           2275489241ull),
	FXC(          3496259414ull,           2494576955ull),
	FXC(18446744071214974661ull,           3496259414ull),
	FXC(           708296459ull,           4236161021ull),
	FXC(18446744069473390595ull,            708296459ull),
	FXC(          4259360959ull,            551895183ull),
	FXC(18446744073157656433ull,           4259360959ull),
	FXC(          2621574191ull,           3402071844ull),
	FXC(18446744070307479772ull,           2621574191ull),
	FXC(          3723935269ull,           2139871536ull),
	FXC(18446744071569680080ull,           3723935269ull),
	FXC(          1120102207ull,           4146337555ull),
	FXC(18446744069563214061ull,           1120102207ull),
	FXC(          4069849124ull,           1372250773ull),
	FXC(18446744072337300843ull,           4069849124ull),
	FXC(          1907490086ull,           3848145741ull),
	FXC(18446744069861405875ull,           1907490086ull),
	FXC(          3234912670ull,           2825258235ull),
	FXC(18446744070884293381ull,           3234912670ull),
	FXC(           289669429ull,           4285187942ull),
	FXC(18446744069424363674ull,            289669429ull),
	FXC(          4281310585ull,            342233465ull),
	FXC(18446744073367318151ull,           4281310585ull),
	FXC(          2785348143ull,           3269339351ull),
	FXC(18446744070440212265ull,           2785348143ull),
	FXC(          3824448145ull,           1954569124ull),
	FXC(18446744071754982492ull,           3824448145ull),
	FXC(          1322204136ull,           4086382299ull),
	FXC(18446744069623169317ull,           1322204136ull),
	FXC(          4132279966ull,           1170899806ull),
	FXC(18446744072538651810ull,           4132279966ull),
	FXC(          2094011993ull,           3749914379ull),
	FXC(18446744069959637237ull,           2094011993ull),
	FXC(          3369644927ull,           2663125446ull),
	FXC(18446744071046426170ull,           3369644927ull),
	FXC(           499584716ull,           4265812840ull),
	FXC(18446744069443738776ull,            499584716ull),
	FXC(          4227150159ull,            760227338ull),
	FXC(18446744072949324278ull,           4227150159ull),
	FXC(          2451484637ull,           3526608449ull),
	FXC(18446744070182943167ull,           2451484637ull),
	FXC(          3614451106ull,           2320018810ull),
	FXC(18446744071389532806ull,           3614451106ull),
	FXC(           915301854ull,           4196303920ull),
	FXC(18446744069513247696ull,            915301854ull),
	FXC(          3997613658ull,           1570295869ull),
	FXC(18446744072139255747ull,           3997613658ull),
	FXC(          1716372869ull,           3937106583ull),
	FXC(18446744069772445033ull,           1716372869ull),
	FXC(          3092387225ull,           2980584729ull),
	FXC(18446744070728966887ull,           3092387225ull),
	FXC(            79056303ull,           4294239650ull),
	FXC(18446744069415311966ull,             79056303ull),
	FXC(          4294239650ull,             79056303ull),
	FXC(18446744073630495313ull,           4294239650ull),
	FXC(          2980584729ull,           3092387225ull),
	FXC(18446744070617164391ull,           2980584729ull),
	FXC(          3937106583ull,           1716372869ull),
	FXC(18446744071993178747ull,           3937106583ull),
	FXC(          1570295869ull,           3997613658ull),
	FXC(18446744069711937958ull,           1570295869ull),
	FXC(          4196303920ull,            915301854ull),
	FXC(18446744072794249762ull,           4196303920ull),
	FXC(          2320018810ull,           3614451106ull),
	FXC(18446744070095100510ull,           2320018810ull),
	FXC(          3526608449ull,           2451484637ull),
	FXC(18446744071258066979ull,           3526608449ull),
	FXC(           760227338ull,           4227150159ull),
	FXC(18446744069482401457ull,            760227338ull),
	FXC(          4265812840ull,            499584716ull),
	FXC(18446744073209966900ull,           4265812840ull),
	FXC(          2663125446ull,           3369644927ull),
	FXC(18446744070339906689ull,           2663125446ull),
	FXC(          3749914379ull,           2094011993ull),
	FXC(18446744071615539623ull,           3749914379ull),
	FXC(          1170899806ull,           4132279966ull),
	FXC(18446744069577271650ull,           1170899806ull),
	FXC(          4086382299ull,           1322204136ull),
	FXC(18446744072387347480ull,           4086382299ull),
	FXC(          1954569124ull,           3824448145ull),
	FXC(18446744069885103471ull,           1954569124ull),
	FXC(          3269339351ull,           2785348143ull),
	FXC(18446744070924203473ull,           3269339351ull),
	FXC(           342233465ull,           4281310585ull),
	FXC(18446744069428241031ull,            342233465ull),
	FXC(          4285187942ull,            289669429ull),
	FXC(18446744073419882187ull,           4285187942ull),
	FXC(          2825258235ull,           3234912670ull),
	FXC(18446744070474638946ull,           2825258235ull),
	FXC(          3848145741ull,           1907490086ull),
	FXC(18446744071802061530ull,           3848145741ull),
	FXC(          1372250773ull,           4069849124ull),
	FXC(18446744069639702492ull,           1372250773ull),
	FXC(          4146337555ull,           1120102207ull),
	FXC(18446744072589449409ull,           4146337555ull),
	FXC(          2139871536ull,           3723935269ull),
	FXC(18446744069985616347ull,           2139871536ull),
	FXC(          3402071844ull,           2621574191ull),
	FXC(18446744071087977425ull,           3402071844ull),
	FXC(           551895183ull,           4259360959ull),
	FXC(18446744069450190657ull,            551895183ull),
	FXC(          4236161021ull,            708296459ull),
	FXC(18446744073001255157ull,           4236161021ull),
	FXC(          2494576955ull,           3496259414ull),
	FXC(18446744070213292202ull,           2494576955ull),
	FXC(          3642649144ull,           2275489241ull),
	FXC(18446744071434062375ull,           3642649144ull),
	FXC(           966728038ull,           4184755784ull),
	FXC(18446744069524795832ull,            966728038ull),
	FXC(          4016582591ull,           1521120759ull),
	FXC(18446744072188430857ull,           4016582591ull),
	FXC(          1764557983ull,           3915747591ull),
	FXC(18446744069793804025ull,           1764557983ull),
	FXC(          3128730733ull,           2942411948ull),
	FXC(18446744070767139668ull,           3128730733ull),
	FXC(           131747276ull,           4292946160ull),
	FXC(18446744069416605456ull,            131747276ull),
	FXC(          4291006167ull,            184418409ull),
	FXC(18446744073525133207ull,           4291006167ull),
	FXC(          2903796051ull,           3164603066ull),
	FXC(18446744070544948550ull,           2903796051ull),
	FXC(          3893798902ull,           1812477362ull),
	FXC(18446744071897074254ull,           3893798902ull),
	FXC(          1471716574ull,           4034946641ull),
	FXC(18446744069674604975ull,           1471716574ull),
	FXC(          4172577440ull,           1018008636ull),
	FXC(18446744072691542980ull,           4172577440ull),
	FXC(          2230616993ull,           3670298613ull),
	FXC(18446744070039253003ull,           2230616993ull),
	FXC(          3465383855ull,           2537293599ull),
	FXC(18446744071172258017ull,           3465383855ull),
	FXC(           656258914ull,           4244533933ull),
	FXC(18446744069465017683ull,            656258914ull),
	FXC(          4252267634ull,            604122538ull),
	FXC(18446744073105429078ull,           4252267634ull),
	FXC(          2579628136ull,           3433986423ull),
	FXC(18446744070275565193ull,           2579628136ull),
	FXC(          3697395348ull,           2185408821ull),
	FXC(18446744071524142795ull,           3697395348ull),
	FXC(          1069135926ull,           4159770720ull),
	FXC(18446744069549780896ull,           1069135926ull),
	FXC(          4052703044ull,           1422090755ull),
	FXC(18446744072287460861ull,           4052703044ull),
	FXC(          1860123788ull,           3871263820ull),
	FXC(18446744069838287796ull,           1860123788ull),
	FXC(          3199998822ull,           2864742853ull),
	FXC(18446744070844808763ull,           3199998822ull),
	FXC(           237061769ull,           4288419964ull),
	FXC(18446744069421131652ull,            237061769ull),
	FXC(          4276788480ull,            394745962ull),
	FXC(18446744073314805654ull,           4276788480ull),
	FXC(          2745018589ull,           3303273682ull),
	FXC(18446744070406277934ull,           2745018589ull),
	FXC(          3800174601ull,           2001353810ull),
	FXC(18446744071708197806ull,           3800174601ull),
	FXC(          1271958380ull,           4102300081ull),
	FXC(18446744069607251535ull,           1271958380ull),
	FXC(          4117600071ull,           1221521071ull),
	FXC(18446744072488030545ull,           4117600071ull),
	FXC(          2047837100ull,           3775328765ull),
	FXC(18446744069934222851ull,           2047837100ull),
	FXC(          3336710553ull,           2704275644ull),
	FXC(18446744071005275972ull,           3336710553ull),
	FXC(           447199012ull,           4271622305ull),
	FXC(18446744069437929311ull,            447199012ull),
	FXC(          4217502704ull,            812043729ull),
	FXC(18446744072897507887ull,           4217502704ull),
	FXC(          2408023134ull,           3556426389ull),
	FXC(18446744070153125227ull,           2408023134ull),
	FXC(          3585708745ull,           2364198992ull),
	FXC(18446744071345352624ull,           3585708745ull),
	FXC(           863737830ull,           4207220108ull),
	FXC(18446744069502331508ull,            863737830ull),
	FXC(          3978042699ull,           1619234497ull),
	FXC(18446744072090317119ull,           3978042699ull),
	FXC(          1667929275ull,           3957872662ull),
	FXC(18446744069751678954ull,           1667929275ull),
	FXC(          3055578014ull,           3018308645ull),
	FXC(18446744070691242971ull,           3055578014ull),
	FXC(            26353424ull,           4294886444ull),
	FXC(18446744069414665172ull,             26353424ull),
	FXC(          4294947083ull,             13176774ull),
	FXC(18446744073696374842ull,           4294947083ull),
	FXC(          3027668821ull,           3046303593ull),
	FXC(18446744070663248023ull,           3027668821ull),
	FXC(          3962971170ull,           1655778843ull),
	FXC(18446744072053772773ull,           3962971170ull),
	FXC(          1631431340ull,           3973056236ull),
	FXC(18446744069736495380ull,           1631431340ull),
	FXC(          4209850218ull,            850826195ull),
	FXC(18446744072858725421ull,           4209850218ull),
	FXC(          2375188665ull,           3578438609ull),
	FXC(18446744070131113007ull,           2375188665ull),
	FXC(          3563797363ull,           2397100839ull),
	FXC(18446744071312450777ull,           3563797363ull),
	FXC(           824979024ull,           4214991540ull),
	FXC(18446744069494560076ull,            824979024ull),
	FXC(          4272974189ull,            434091755ull),
	FXC(18446744073275459861ull,           4272974189ull),
	FXC(          2714499801ull,           3328398249ull),
	FXC(18446744070381153367ull,           2714499801ull),
	FXC(          3781593674ull,           2036244917ull),
	FXC(18446744071673306699ull,           3781593674ull),
	FXC(          1234147941ull,           4113833119ull),
	FXC(18446744069595718497ull,           1234147941ull),
	FXC(          4106183088ull,           1259366714ull),
	FXC(18446744072450184902ull,           4106183088ull),
	FXC(          2013003163ull,           3794016650ull),
	FXC(18446744069915534966ull,           2013003163ull),
	FXC(          3311679735ull,           2734871369ull),
	FXC(18446744070974680247ull,           3311679735ull),
	FXC(           407865107ull,           4275557289ull),
	FXC(18446744069433994327ull,            407865107ull),
	FXC(          4289127078ull,            223903967ull),
	FXC(18446744073485647649ull,           4289127078ull),
	FXC(          2874546829ull,           3191194855ull),
	FXC(18446744070518356761ull,           2874546829ull),
	FXC(          3876952381ull,           1848238164ull),
	FXC(18446744071861313452ull,           3876952381ull),
	FXC(          1434517580ull,           4048321058ull),
	FXC(18446744069661230558ull,           1434517580ull),
	FXC(          4163031206ull,           1056368897ull),
	FXC(18446744072653182719ull,           4163031206ull),
	FXC(          2196741986ull,           3690673207ull),
	FXC(18446744070018878409ull,           2196741986ull),
	FXC(          3441884449ull,           2569080674ull),
	FXC(18446744071140470942ull,           3441884449ull),
	FXC(           617165468ull,           4250394200ull),
	FXC(18446744069459157416ull,            617165468ull),
	FXC(          4246527332ull,            643233779ull),
	FXC(18446744073066317837ull,           4246527332ull),
	FXC(          2547913306ull,           3457583240ull),
	FXC(18446744070251968376ull,           2547913306ull),
	FXC(          3677124776ull,           2219346178ull),
	FXC(18446744071490205438ull,           3677124776ull),
	FXC(          1030805132ull,           4169434596ull),
	FXC(18446744069540117020ull,           1030805132ull),
	FXC(          4039442815ull,           1459330606ull),
	FXC(18446744072250221010ull,           4039442815ull),
	FXC(          1824414839ull,           3888219974ull),
	FXC(18446744069821331642ull,           1824414839ull),
	FXC(          3173496894ull,           2894073520ull),
	FXC(18446744070815478096ull,           3173496894ull),
	FXC(           197582163ull,           4290420185ull),
	FXC(18446744069419131431ull,            197582163ull),
	FXC(          4293330151ull,            118576083ull),
	FXC(18446744073590975533ull,           4293330151ull),
	FXC(          2951996911ull,           3119688816ull),
	FXC(18446744070589862800ull,           2951996911ull),
	FXC(          3921142750ull,           1752536335ull),
	FXC(18446744071957015281ull,           3921142750ull),
	FXC(          1533436302ull,           4011896955ull),
	FXC(18446744069697654661ull,           1533436302ull),
	FXC(          4187701970ull,            953884839ull),
	FXC(18446744072755666777ull,           4187701970ull),
	FXC(          2286654023ull,           3635650898ull),
	FXC(18446744070073900718ull,           2286654023ull),
	FXC(          3503896214ull,           2483838842ull),
	FXC(18446744071225712774ull,           3503896214ull),
	FXC(           721289485ull,           4233968062ull),
	FXC(18446744069475583554ull,            721289485ull),
	FXC(          4261034104ull,            538825051ull),
	FXC(18446744073170726565ull,           4261034104ull),
	FXC(          2631999263ull,           3394012957ull),
	FXC(18446744070315538659ull,           2631999263ull),
	FXC(          3730482776ull,           2128436593ull),
	FXC(18446744071581115023ull,           3730482776ull),
	FXC(          1132817720ull,           4142881616ull),
	FXC(18446744069566670000ull,           1132817720ull),
	FXC(          4074039976ull,           1359758194ull),
	FXC(18446744072349793422ull,           4074039976ull),
	FXC(          1919287054ull,           3842275534ull),
	FXC(18446744069867276082ull,           1919287054ull),
	FXC(          3243565216ull,           2815320366ull),
	FXC(18446744070894231250ull,           3243565216ull),
	FXC(           302814837ull,           4284279082ull),
	FXC(18446744069425272534ull,            302814837ull),
	FXC(          4282340394ull,            329096979ull),
	FXC(18446744073380454637ull,           4282340394ull),
	FXC(          2795365227ull,           3260778637ull),
	FXC(18446744070448772979ull,           2795365227ull),
	FXC(          3830426680ull,           1942826684ull),
	FXC(18446744071766724932ull,           3830426680ull),
	FXC(          1334734758ull,           4082306603ull),
	FXC(18446744069627245013ull,           1334734758ull),
	FXC(          4135852789ull,           1158216639ull),
	FXC(18446744072551334977ull,           4135852789ull),
	FXC(          2105506713ull,           3743472393ull),
	FXC(18446744069966079223ull,           2105506713ull),
	FXC(          3377799422ull,           2652774988ull),
	FXC(18446744071056776628ull,           3377799422ull),
	FXC(           512669694ull,           4264260060ull),
	FXC(18446744069445291556ull,            512669694ull),
	FXC(          4229462610ull,            747255046ull),
	FXC(18446744072962296570ull,           4229462610ull),
	FXC(          2462292582ull,           3519070803ull),
	FXC(18446744070190480813ull,           2462292582ull),
	FXC(          3621551813ull,           2308918911ull),
	FXC(18446744071400632705ull,           3621551813ull),
	FXC(           928171626ull,           4193476065ull),
	FXC(18446744069516075551ull,            928171626ull),
	FXC(          4002412444ull,           1558023973ull),
	FXC(18446744072151527643ull,           4002412444ull),
	FXC(          1728443664ull,           3931822297ull),
	FXC(18446744069777729319ull,           1728443664ull),
	FXC(          3101516976ull,           2971083391ull),
	FXC(18446744070738468225ull,           3101516976ull),
	FXC(            92230472ull,           4293976900ull),
	FXC(18446744069415574716ull,             92230472ull),
	FXC(          4294461982ull,             65881389ull),
	FXC(18446744073643670227ull,           4294461982ull),
	FXC(          2990058012ull,           3083228366ull),
	FXC(18446744070626323250ull,           2990058012ull),
	FXC(          3942353812ull,           1704285919ull),
	FXC(18446744072005265697ull,           3942353812ull),
	FXC(          1582552984ull,           3992777245ull),
	FXC(18446744069716774371ull,           1582552984ull),
	FXC(          4199092278ull,            902423468ull),
	FXC(18446744072807128148ull,           4199092278ull),
	FXC(          2331096871ull,           3607316378ull),
	FXC(18446744070102235238ull,           2331096871ull),
	FXC(          3534112901ull,           2440653617ull),
	FXC(18446744071268897999ull,           3534112901ull),
	FXC(           773192474ull,           4224797921ull),
	FXC(18446744069484753695ull,            773192474ull),
	FXC(          4267325469ull,            486495035ull),
	FXC(18446744073223056581ull,           4267325469ull),
	FXC(          2673450838ull,           3361458715ull),
	FXC(18446744070348092901ull,           2673450838ull),
	FXC(          3756321069ull,           2082497563ull),
	FXC(18446744071627054053ull,           3756321069ull),
	FXC(          1183571952ull,           4128668249ull),
	FXC(18446744069580883367ull,           1183571952ull),
	FXC(          4090419533ull,           1309661069ull),
	FXC(18446744072399890547ull,           4090419533ull),
	FXC(          1966293167ull,           3818433613ull),
	FXC(18446744069891118003ull,           1966293167ull),
	FXC(          3277869293ull,           2775304843ull),
	FXC(18446744070934246773ull,           3277869293ull),
	FXC(           355366730ull,           4280240479ull),
	FXC(18446744069429311137ull,            355366730ull),
	FXC(          4286056468ull,            276521294ull),
	FXC(18446744073433030322ull,           4286056468ull),
	FXC(          2835169511ull,           3226229675ull),
	FXC(18446744070483321941ull,           2835169511ull),
	FXC(          3853979728ull,           1895675165ull),
	FXC(18446744071813876451ull,           3853979728ull),
	FXC(          1384730436ull,           4065619964ull),
	FXC(18446744069643931652ull,           1384730436ull),
	FXC(          4149754467ull,           1107376152ull),
	FXC(18446744072602175464ull,           4149754467ull),
	FXC(          2151286337ull,           3717352710ull),
	FXC(18446744069992198906ull,           2151286337ull),
	FXC(          3410098710ull,           2611124444ull),
	FXC(18446744071098427172ull,           3410098710ull),
	FXC(           564960121ull,           4257647723ull),
	FXC(18446744069451903893ull,            564960121ull),
	FXC(          4238314108ull,            695296767ull),
	FXC(18446744073014254849ull,           4238314108ull),
	FXC(          2505291588ull,           3488589706ull),
	FXC(18446744070220961910ull,           2505291588ull),
	FXC(          3649613104ull,           2264303042ull),
	FXC(18446744071445248574ull,           3649613104ull),
	FXC(           979562138ull,           4181770210ull),
	FXC(18446744069527781406ull,            979562138ull),
	FXC(          4021230421ull,           1508790899ull),
	FXC(18446744072200760717ull,           4021230421ull),
	FXC(          1776563023ull,           3910315575ull),
	FXC(18446744069799236041ull,           1776563023ull),
	FXC(          3137743202ull,           2932799290ull),
	FXC(18446744070776752326ull,           3137743202ull),
	FXC(           144917230ull,           4292521761ull),
	FXC(18446744069417029855ull,            144917230ull),
	FXC(          4291551760ull,            171252920ull),
	FXC(18446744073538298696ull,           4291551760ull),
	FXC(          2913491250ull,           3155679453ull),
	FXC(18446744070553872163ull,           2913491250ull),
	FXC(          3899341179ull,           1800522825ull),
	FXC(18446744071909028791ull,           3899341179ull),
	FXC(          1484088690ull,           4030412489ull),
	FXC(18446744069679139127ull,           1484088690ull),
	FXC(          4175681009ull,           1005202558ull),
	FXC(18446744072704349058ull,           4175681009ull),
	FXC(          2241866812ull,           3663437903ull),
	FXC(18446744070046113713ull,           2241866812ull),
	FXC(          3473151854ull,           2526650010ull),
	FXC(18446744071182901606ull,           3473151854ull),
	FXC(           669277872ull,           4242500584ull),
	FXC(18446744069467051032ull,            669277872ull),
	FXC(          4254101044ull,            591073921ull),
	FXC(18446744073118477695ull,           4254101044ull),
	FXC(          2590151318ull,           3426056074ull),
	FXC(18446744070283495542ull,           2590151318ull),
	FXC(          3704082687ull,           2174055087ull),
	FXC(18446744071535496529ull,           3704082687ull),
	FXC(          1081892891ull,           4156471081ull),
	FXC(18446744069553080535ull,           1081892891ull),
	FXC(          4057046884ull,           1409650544ull),
	FXC(18446744072299901072ull,           4057046884ull),
	FXC(          1871991904ull,           3865538822ull),
	FXC(18446744069844012794ull,           1871991904ull),
	FXC(          3208772670ull,           2854911913ull),
	FXC(18446744070854639703ull,           3208772670ull),
	FXC(           250217341ull,           4287672487ull),
	FXC(18446744069421879129ull,            250217341ull),
	FXC(          4277979416ull,            381623102ull),
	FXC(18446744073327928514ull,           4277979416ull),
	FXC(          2755139971ull,           3294836538ull),
	FXC(18446744070414715078ull,           2755139971ull),
	FXC(          3806296784ull,           1989685620ull),
	FXC(18446744071719865996ull,           3806296784ull),
	FXC(          1284538073ull,           4098378461ull),
	FXC(18446744069611173155ull,           1284538073ull),
	FXC(          4121328267ull,           1208882703ull),
	FXC(18446744072500668913ull,           4121328267ull),
	FXC(          2059410008ull,           3769028322ull),
	FXC(18446744069940523294ull,           2059410008ull),
	FXC(          3344991450ull,           2694026034ull),
	FXC(18446744071015525582ull,           3344991450ull),
	FXC(           460302060ull,           4270230215ull),
	FXC(18446744069439321401ull,            460302060ull),
	FXC(          4219974170ull,            799100792ull),
	FXC(18446744072910450824ull,           4219974170ull),
	FXC(          2418922764ull,           3549021941ull),
	FXC(18446744070160529675ull,           2418922764ull),
	FXC(          3592945130ull,           2353187066ull),
	FXC(18446744071356364550ull,           3592945130ull),
	FXC(           876641334ull,           4204550397ull),
	FXC(18446744069505001219ull,            876641334ull),
	FXC(          3982991719ull,           1607022414ull),
	FXC(18446744072102529202ull,           3982991719ull),
	FXC(          1680064008ull,           3952736900ull),
	FXC(18446744069756814716ull,           1680064008ull),
	FXC(          3064823674ull,           3008920059ull),
	FXC(18446744070700631557ull,           3064823674ull),
	FXC(            39529826ull,           4294785381ull),
	FXC(18446744069414766235ull,             39529826ull),
	FXC(          4294785381ull,             39529826ull),
	FXC(18446744073670021790ull,           4294785381ull),
	FXC(          3008920059ull,           3064823674ull),
	FXC(18446744070644727942ull,           3008920059ull),
	FXC(          3952736900ull,           1680064008ull),
	FXC(18446744072029487608ull,           3952736900ull),
	FXC(          1607022414ull,           3982991719ull),
	FXC(18446744069726559897ull,           1607022414ull),
	FXC(          4204550397ull,            876641334ull),
	FXC(18446744072832910282ull,           4204550397ull),
	FXC(          2353187066ull,           3592945130ull),
	FXC(18446744070116606486ull,           2353187066ull),
	FXC(          3549021941ull,           2418922764ull),
	FXC(18446744071290628852ull,           3549021941ull),
	FXC(           799100792ull,           4219974170ull),
	FXC(18446744069489577446ull,            799100792ull),
	FXC(          4270230215ull,            460302060ull),
	FXC(18446744073249249556ull,           4270230215ull),
	FXC(          2694026034ull,           3344991450ull),
	FXC(18446744070364560166ull,           2694026034ull),
	FXC(          3769028322ull,           2059410008ull),
	FXC(18446744071650141608ull,           3769028322ull),
	FXC(          1208882703ull,           4121328267ull),
	FXC(18446744069588223349ull,           1208882703ull),
	FXC(          4098378461ull,           1284538073ull),
	FXC(18446744072425013543ull,           4098378461ull),
	FXC(          1989685620ull,           3806296784ull),
	FXC(18446744069903254832ull,           1989685620ull),
	FXC(          3294836538ull,           2755139971ull),
	FXC(18446744070954411645ull,           3294836538ull),
	FXC(           381623102ull,           4277979416ull),
	FXC(18446744069431572200ull,            381623102ull),
	FXC(          4287672487ull,            250217341ull),
	FXC(18446744073459334275ull,           4287672487ull),
	FXC(          2854911913ull,           3208772670ull),
	FXC(18446744070500778946ull,           2854911913ull),
	FXC(          3865538822ull,           1871991904ull),
	FXC(18446744071837559712ull,           3865538822ull),
	FXC(          1409650544ull,           4057046884ull),
	FXC(18446744069652504732ull,           1409650544ull),
	FXC(          4156471081ull,           1081892891ull),
	FXC(18446744072627658725ull,           4156471081ull),
	FXC(          2174055087ull,           3704082687ull),
	FXC(18446744070005468929ull,           2174055087ull),
	FXC(          3426056074ull,           2590151318ull),
	FXC(18446744071119400298ull,           3426056074ull),
	FXC(           591073921ull,           4254101044ull),
	FXC(18446744069455450572ull,            591073921ull),
	FXC(          4242500584ull,            669277872ull),
	FXC(18446744073040273744ull,           4242500584ull),
	FXC(          2526650010ull,           3473151854ull),
	FXC(18446744070236399762ull,           2526650010ull),
	FXC(          3663437903ull,           2241866812ull),
	FXC(18446744071467684804ull,           3663437903ull),
	FXC(          1005202558ull,           4175681009ull),
	FXC(18446744069533870607ull,           1005202558ull),
	FXC(          4030412489ull,           1484088690ull),
	FXC(18446744072225462926ull,           4030412489ull),
	FXC(          1800522825ull,           3899341179ull),
	FXC(18446744069810210437ull,           1800522825ull),
	FXC(          3155679453ull,           2913491250ull),
	FXC(18446744070796060366ull,           3155679453ull),
	FXC(           171252920ull,           4291551760ull),
	FXC(18446744069417999856ull,            171252920ull),
	FXC(          4292521761ull,            144917230ull),
	FXC(18446744073564634386ull,           4292521761ull),
	FXC(          2932799290ull,           3137743202ull),
	FXC(18446744070571808414ull,           2932799290ull),
	FXC(          3910315575ull,           1776563023ull),
	FXC(18446744071932988593ull,           3910315575ull),
	FXC(          1508790899ull,           4021230421ull),
	FXC(18446744069688321195ull,           1508790899ull),
	FXC(          4181770210ull,            979562138ull),
	FXC(18446744072729989478ull,           4181770210ull),
	FXC(          2264303042ull,           3649613104ull),
	FXC(18446744070059938512ull,           2264303042ull),
	FXC(          3488589706ull,           2505291588ull),
	FXC(18446744071204260028ull,           3488589706ull),
	FXC(           695296767ull,           4238314108ull),
	FXC(18446744069471237508ull,            695296767ull),
	FXC(          4257647723ull,            564960121ull),
	FXC(18446744073144591495ull,           4257647723ull),
	FXC(          2611124444ull,           3410098710ull),
	FXC(18446744070299452906ull,           2611124444ull),
	FXC(          3717352710ull,           2151286337ull),
	FXC(18446744071558265279ull,           3717352710ull),
	FXC(          1107376152ull,           4149754467ull),
	FXC(18446744069559797149ull,           1107376152ull),
	FXC(          4065619964ull,           1384730436ull),
	FXC(18446744072324821180ull,           4065619964ull),
	FXC(          1895675165ull,           3853979728ull),
	FXC(18446744069855571888ull,           1895675165ull),
	FXC(          3226229675ull,           2835169511ull),
	FXC(18446744070874382105ull,           3226229675ull),
	FXC(           276521294ull,           4286056468ull),
	FXC(18446744069423495148ull,            276521294ull),
	FXC(          4280240479ull,            355366730ull),
	FXC(18446744073354184886ull,           4280240479ull),
	FXC(          2775304843ull,           3277869293ull),
	FXC(18446744070431682323ull,           2775304843ull),
	FXC(          3818433613ull,           1966293167ull),
	FXC(18446744071743258449ull,           3818433613ull),
	FXC(          1309661069ull,           4090419533ull),
	FXC(18446744069619132083ull,           1309661069ull),
	FXC(          4128668249ull,           1183571952ull),
	FXC(18446744072525979664ull,           4128668249ull),
	FXC(          2082497563ull,           3756321069ull),
	FXC(18446744069953230547ull,           2082497563ull),
	FXC(          3361458715ull,           2673450838ull),
	FXC(18446744071036100778ull,           3361458715ull),
	FXC(           486495035ull,           4267325469ull),
	FXC(18446744069442226147ull,            486495035ull),
	FXC(          4224797921ull,            773192474ull),
	FXC(18446744072936359142ull,           4224797921ull),
	FXC(          2440653617ull,           3534112901ull),
	FXC(18446744070175438715ull,           2440653617ull),
	FXC(          3607316378ull,           2331096871ull),
	FXC(18446744071378454745ull,           3607316378ull),
	FXC(           902423468ull,           4199092278ull),
	FXC(18446744069510459338ull,            902423468ull),
	FXC(          3992777245ull,           1582552984ull),
	FXC(18446744072126998632ull,           3992777245ull),
	FXC(          1704285919ull,           3942353812ull),
	FXC(18446744069767197804ull,           1704285919ull),
	FXC(          3083228366ull,           2990058012ull),
	FXC(18446744070719493604ull,           3083228366ull),
	FXC(            65881389ull,           4294461982ull),
	FXC(18446744069415089634ull,             65881389ull),
	FXC(          4293976900ull,             92230472ull),
	FXC(18446744073617321144ull,           4293976900ull),
	FXC(          2971083391ull,           3101516976ull),
	FXC(18446744070608034640ull,           2971083391ull),
	FXC(          3931822297ull,           1728443664ull),
	FXC(18446744071981107952ull,           3931822297ull),
	FXC(          1558023973ull,           4002412444ull),
	FXC(18446744069707139172ull,           1558023973ull),
	FXC(          4193476065ull,            928171626ull),
	FXC(18446744072781379990ull,           4193476065ull),
	FXC(          2308918911ull,           3621551813ull),
	FXC(18446744070087999803ull,           2308918911ull),
	FXC(          3519070803ull,           2462292582ull),
	FXC(18446744071247259034ull,           3519070803ull),
	FXC(           747255046ull,           4229462610ull),
	FXC(18446744069480089006ull,            747255046ull),
	FXC(          4264260060ull,            512669694ull),
	FXC(18446744073196881922ull,           4264260060ull),
	FXC(          2652774988ull,           3377799422ull),
	FXC(18446744070331752194ull,           2652774988ull),
	FXC(          3743472393ull,           2105506713ull),
	FXC(18446744071604044903ull,           3743472393ull),
	FXC(          1158216639ull,           4135852789ull),
	FXC(18446744069573698827ull,           1158216639ull),
	FXC(          4082306603ull,           1334734758ull),
	FXC(18446744072374816858ull,           4082306603ull),
	FXC(          1942826684ull,           3830426680ull),
	FXC(18446744069879124936ull,           1942826684ull),
	FXC(          3260778637ull,           2795365227ull),
	FXC(18446744070914186389ull,           3260778637ull),
	FXC(           329096979ull,           4282340394ull),
	FXC(18446744069427211222ull,            329096979ull),
	FXC(          4284279082ull,            302814837ull),
	FXC(18446744073406736779ull,           4284279082ull),
	FXC(          2815320366ull,           3243565216ull),
	FXC(18446744070465986400ull,           2815320366ull),
	FXC(          3842275534ull,           1919287054ull),
	FXC(18446744071790264562ull,           3842275534ull),
	FXC(          1359758194ull,           4074039976ull),
	FXC(18446744069635511640ull,           1359758194ull),
	FXC(          4142881616ull,           1132817720ull),
	FXC(18446744072576733896ull,           4142881616ull),
	FXC(          2128436593ull,           3730482776ull),
	FXC(18446744069979068840ull,           2128436593ull),
	FXC(          3394012957ull,           2631999263ull),
	FXC(18446744071077552353ull,           3394012957ull),
	FXC(           538825051ull,           4261034104ull),
	FXC(18446744069448517512ull,            538825051ull),
	FXC(          4233968062ull,            721289485ull),
	FXC(18446744072988262131ull,           4233968062ull),
	FXC(          2483838842ull,           3503896214ull),
	FXC(18446744070205655402ull,           2483838842ull),
	FXC(          3635650898ull,           2286654023ull),
	FXC(18446744071422897593ull,           3635650898ull),
	FXC(           953884839ull,           4187701970ull),
	FXC(18446744069521849646ull,            953884839ull),
	FXC(          4011896955ull,           1533436302ull),
	FXC(18446744072176115314ull,           4011896955ull),
	FXC(          1752536335ull,           3921142750ull),
	FXC(18446744069788408866ull,           1752536335ull),
	FXC(          3119688816ull,           2951996911ull),
	FXC(18446744070757554705ull,           3119688816ull),
	FXC(           118576083ull,           4293330151ull),
	FXC(18446744069416221465ull,            118576083ull),
	FXC(          4290420185ull,            197582163ull),
	FXC(18446744073511969453ull,           4290420185ull),
	FXC(          2894073520ull,           3173496894ull),
	FXC(18446744070536054722ull,           2894073520ull),
	FXC(          3888219974ull,           1824414839ull),
	FXC(18446744071885136777ull,           3888219974ull),
	FXC(          1459330606ull,           4039442815ull),
	FXC(18446744069670108801ull,           1459330606ull),
	FXC(          4169434596ull,           1030805132ull),
	FXC(18446744072678746484ull,           4169434596ull),
	FXC(          2219346178ull,           3677124776ull),
	FXC(18446744070032426840ull,           2219346178ull),
	FXC(          3457583240ull,           2547913306ull),
	FXC(18446744071161638310ull,           3457583240ull),
	FXC(           643233779ull,           4246527332ull),
	FXC(18446744069463024284ull,            643233779ull),
	FXC(          4250394200ull,            617165468ull),
	FXC(18446744073092386148ull,           4250394200ull),
	FXC(          2569080674ull,           3441884449ull),
	FXC(18446744070267667167ull,           2569080674ull),
	FXC(          3690673207ull,           2196741986ull),
	FXC(18446744071512809630ull,           3690673207ull),
	FXC(          1056368897ull,           4163031206ull),
	FXC(18446744069546520410ull,           1056368897ull),
	FXC(          4048321058ull,           1434517580ull),
	FXC(18446744072275034036ull,           4048321058ull),
	FXC(          1848238164ull,           3876952381ull),
	FXC(18446744069832599235ull,           1848238164ull),
	FXC(          3191194855ull,           2874546829ull),
	FXC(18446744070835004787ull,           3191194855ull),
	FXC(           223903967ull,           4289127078ull),
	FXC(18446744069420424538ull,            223903967ull),
	FXC(          4275557289ull,            407865107ull),
	FXC(18446744073301686509ull,           4275557289ull),
	FXC(          2734871369ull,           3311679735ull),
	FXC(18446744070397871881ull,           2734871369ull),
	FXC(          3794016650ull,           2013003163ull),
	FXC(18446744071696548453ull,           3794016650ull),
	FXC(          1259366714ull,           4106183088ull),
	FXC(18446744069603368528ull,           1259366714ull),
	FXC(          4113833119ull,           1234147941ull),
	FXC(18446744072475403675ull,           4113833119ull),
	FXC(          2036244917ull,           3781593674ull),
	FXC(18446744069927957942ull,           2036244917ull),
	FXC(          3328398249ull,           2714499801ull),
	FXC(18446744070995051815ull,           3328398249ull),
	FXC(           434091755ull,           4272974189ull),
	FXC(18446744069436577427ull,            434091755ull),
	FXC(          4214991540ull,            824979024ull),
	FXC(18446744072884572592ull,           4214991540ull),
	FXC(          2397100839ull,           3563797363ull),
	FXC(18446744070145754253ull,           2397100839ull),
	FXC(          3578438609ull,           2375188665ull),
	FXC(18446744071334362951ull,           3578438609ull),
	FXC(           850826195ull,           4209850218ull),
	FXC(18446744069499701398ull,            850826195ull),
	FXC(          3973056236ull,           1631431340ull),
	FXC(18446744072078120276ull,           3973056236ull),
	FXC(          1655778843ull,           3962971170ull),
	FXC(18446744069746580446ull,           1655778843ull),
	FXC(          3046303593ull,           3027668821ull),
	FXC(18446744070681882795ull,           3046303593ull),
	FXC(            13176774ull,           4294947083ull),
	FXC(18446744069414604533ull,             13176774ull)
};

#if NTRUGEN_AVX2
TARGET_AVX2
static inline void
fxp_FFT4(__m256i *ya0_re, __m256i *ya1_re, __m256i *ya0_im, __m256i *ya1_im,
	size_t k)
{
	__m256i yv0_re = *ya0_re;
	__m256i yv1_re = *ya1_re;
	__m256i yv0_im = *ya0_im;
	__m256i yv1_im = *ya1_im;
	__m256i yt0_re, yt0_im, yt1_re, yt1_im;

	/*
	 * yv0: 0:1:2:3
	 * yv1: 4:5:6:7
	 * combine 0/2 and 1/3 with gm[k+0]
	 * combine 4/6 and 5/7 with gm[k+1]
	 */

	/* yt0 <- 0:1:4:5
	   yt1 <- 2:3:6:7 */
	yt0_re = _mm256_permute2x128_si256(yv0_re, yv1_re, 0x20);
	yt0_im = _mm256_permute2x128_si256(yv0_im, yv1_im, 0x20);
	yt1_re = _mm256_permute2x128_si256(yv0_re, yv1_re, 0x31);
	yt1_im = _mm256_permute2x128_si256(yv0_im, yv1_im, 0x31);

	/* yg0 <- gm0:gm0:gm1:gm1 */
	__m256i yg0 = _mm256_loadu_si256((const __m256i *)(GM_TAB + k));
	__m256i yg0_re = _mm256_shuffle_epi32(yg0, 0x44);
	__m256i yg0_im = _mm256_shuffle_epi32(yg0, 0xEE);

	fxc_mul_x4(&yt1_re, &yt1_im, yt1_re, yt1_im, yg0_re, yg0_im);

	yv0_re = _mm256_add_epi64(yt0_re, yt1_re);
	yv0_im = _mm256_add_epi64(yt0_im, yt1_im);
	yv1_re = _mm256_sub_epi64(yt0_re, yt1_re);
	yv1_im = _mm256_sub_epi64(yt0_im, yt1_im);

	/*
	 * v0: 0:1:4:5
	 * v1: 2:3:6:7
	 * combine 0/1 with gm[2*k+0], 2/3 with gm[2*k+1]
	 * combine 4/5 with gm[2*k+2], 6/7 with gm[2*k+3]
	 */

	/* yt0 <- 0:2:4:6
	   yt1 <- 1:3:5:7 */
	yt0_re = _mm256_unpacklo_epi64(yv0_re, yv1_re);
	yt0_im = _mm256_unpacklo_epi64(yv0_im, yv1_im);
	yt1_re = _mm256_unpackhi_epi64(yv0_re, yv1_re);
	yt1_im = _mm256_unpackhi_epi64(yv0_im, yv1_im);

	/* yg1 <- gm4:gm5:gm6:gm7 */
	__m256i yg1_re = _mm256_setr_epi64x(
		GM_TAB[(k << 1) + 0].re.v,
		GM_TAB[(k << 1) + 1].re.v,
		GM_TAB[(k << 1) + 2].re.v,
		GM_TAB[(k << 1) + 3].re.v);
	__m256i yg1_im = _mm256_setr_epi64x(
		GM_TAB[(k << 1) + 0].im.v,
		GM_TAB[(k << 1) + 1].im.v,
		GM_TAB[(k << 1) + 2].im.v,
		GM_TAB[(k << 1) + 3].im.v);

	fxc_mul_x4(&yt1_re, &yt1_im, yt1_re, yt1_im, yg1_re, yg1_im);

	yv0_re = _mm256_add_epi64(yt0_re, yt1_re);
	yv0_im = _mm256_add_epi64(yt0_im, yt1_im);
	yv1_re = _mm256_sub_epi64(yt0_re, yt1_re);
	yv1_im = _mm256_sub_epi64(yt0_im, yt1_im);

	/*
	 * Reorder into 0:1:2:3 and 4:5:6:7
	 */
	yt0_re = _mm256_unpacklo_epi64(yv0_re, yv1_re);
	yt0_im = _mm256_unpacklo_epi64(yv0_im, yv1_im);
	yt1_re = _mm256_unpackhi_epi64(yv0_re, yv1_re);
	yt1_im = _mm256_unpackhi_epi64(yv0_im, yv1_im);
	yv0_re = _mm256_permute2x128_si256(yt0_re, yt1_re, 0x20);
	yv0_im = _mm256_permute2x128_si256(yt0_im, yt1_im, 0x20);
	yv1_re = _mm256_permute2x128_si256(yt0_re, yt1_re, 0x31);
	yv1_im = _mm256_permute2x128_si256(yt0_im, yt1_im, 0x31);

	*ya0_re = yv0_re;
	*ya0_im = yv0_im;
	*ya1_re = yv1_re;
	*ya1_im = yv1_im;
}
#endif // NTRUGEN_AVX2

/* see ng_inner.h */
TARGET_AVX2
void
vect_FFT(unsigned logn, fxr *f)
{
	size_t hn = (size_t)1 << (logn - 1);
	size_t t = hn;
#if NTRUGEN_AVX2
	if (logn >= 4) {
		for (unsigned lm = 1; lm < (logn - 2); lm ++) {
			size_t m = (size_t)1 << lm;
			size_t ht = t >> 1;
			size_t j0 = 0;
			size_t hm = m >> 1;
			for (size_t i = 0; i < hm; i ++) {
				fxc s = GM_TAB[m + i];
				__m256i ys_re = _mm256_set1_epi64x(s.re.v);
				__m256i ys_im = _mm256_set1_epi64x(s.im.v);
				for (size_t j = j0; j < j0 + ht; j += 4) {
					__m256i ya_re = _mm256_loadu_si256(
						(__m256i *)(f + j));
					__m256i ya_im = _mm256_loadu_si256(
						(__m256i *)(f + j + hn));
					__m256i yb_re = _mm256_loadu_si256(
						(__m256i *)(f + j + ht));
					__m256i yb_im = _mm256_loadu_si256(
						(__m256i *)(f + j + ht + hn));
					fxc_mul_x4(&yb_re, &yb_im,
						yb_re, yb_im, ys_re, ys_im);
					__m256i yc_re = _mm256_add_epi64(
						ya_re, yb_re);
					__m256i yc_im = _mm256_add_epi64(
						ya_im, yb_im);
					__m256i yd_re = _mm256_sub_epi64(
						ya_re, yb_re);
					__m256i yd_im = _mm256_sub_epi64(
						ya_im, yb_im);
					_mm256_storeu_si256(
						(__m256i *)(f + j),
						yc_re);
					_mm256_storeu_si256(
						(__m256i *)(f + j + hn),
						yc_im);
					_mm256_storeu_si256(
						(__m256i *)(f + j + ht),
						yd_re);
					_mm256_storeu_si256(
						(__m256i *)(f + j + ht + hn),
						yd_im);
				}
				j0 += t;
			}
			t = ht;
		}

		size_t m = hn >> 1;
		size_t hm = m >> 1;
		for (size_t i = 0; i < hm; i += 2) {
			__m256i ya0_re = _mm256_loadu_si256(
				(const __m256i *)(f + (i << 2) + 0));
			__m256i ya1_re = _mm256_loadu_si256(
				(const __m256i *)(f + (i << 2) + 4));
			__m256i ya0_im = _mm256_loadu_si256(
				(const __m256i *)(f + hn + (i << 2) + 0));
			__m256i ya1_im = _mm256_loadu_si256(
				(const __m256i *)(f + hn + (i << 2) + 4));
			fxp_FFT4(&ya0_re, &ya1_re, &ya0_im, &ya1_im, m + i);
			_mm256_storeu_si256(
				(__m256i *)(f + (i << 2) + 0), ya0_re);
			_mm256_storeu_si256(
				(__m256i *)(f + (i << 2) + 4), ya1_re);
			_mm256_storeu_si256(
				(__m256i *)(f + hn + (i << 2) + 0), ya0_im);
			_mm256_storeu_si256(
				(__m256i *)(f + hn + (i << 2) + 4), ya1_im);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (unsigned lm = 1; lm < logn; lm ++) {
		size_t m = (size_t)1 << lm;
		size_t ht = t >> 1;
		size_t j0 = 0;
		size_t hm = m >> 1;
		for (size_t i = 0; i < hm; i ++) {
			fxc s = GM_TAB[m + i];
			for (size_t j = j0; j < j0 + ht; j ++) {
				fxc x, y;
				x.re = f[j];
				x.im = f[j + hn];
				y.re = f[j + ht];
				y.im = f[j + ht + hn];
				y = fxc_mul(s, y);
				fxc z1 = fxc_add(x, y);
				f[j] = z1.re;
				f[j + hn] = z1.im;
				fxc z2 = fxc_sub(x, y);
				f[j + ht] = z2.re;
				f[j + ht + hn] = z2.im;
			}
			j0 += t;
		}
		t = ht;
	}
}

#if NTRUGEN_AVX2
TARGET_AVX2
static inline void
fxp_iFFT4(__m256i *ya0_re, __m256i *ya1_re, __m256i *ya0_im, __m256i *ya1_im,
	size_t k)
{
	__m256i yv0_re = *ya0_re;
	__m256i yv1_re = *ya1_re;
	__m256i yv0_im = *ya0_im;
	__m256i yv1_im = *ya1_im;
	__m256i yt0_re, yt0_im, yt1_re, yt1_im;

	/*
	 * v0: 0:1:2:3
	 * v1: 4:5:6:7
	 * combine 0/1 with gm[2*k+0], 2/3 with gm[2*k+1]
	 * combine 4/5 with gm[2*k+2], 6/7 with gm[2*k+3]
	 */

	/* yt0 <- 0:4:2:6
	   yt1 <- 1:5:3:7 */
	yt0_re = _mm256_unpacklo_epi64(yv0_re, yv1_re);
	yt0_im = _mm256_unpacklo_epi64(yv0_im, yv1_im);
	yt1_re = _mm256_unpackhi_epi64(yv0_re, yv1_re);
	yt1_im = _mm256_unpackhi_epi64(yv0_im, yv1_im);

	/* yg1 <- gm4:gm6:gm5:gm7 */
	__m256i yg1_re = _mm256_setr_epi64x(
		GM_TAB[(k << 1) + 0].re.v,
		GM_TAB[(k << 1) + 2].re.v,
		GM_TAB[(k << 1) + 1].re.v,
		GM_TAB[(k << 1) + 3].re.v);
	__m256i yg1_im = _mm256_setr_epi64x(
		GM_TAB[(k << 1) + 0].im.v,
		GM_TAB[(k << 1) + 2].im.v,
		GM_TAB[(k << 1) + 1].im.v,
		GM_TAB[(k << 1) + 3].im.v);
	yg1_im = _mm256_sub_epi64(_mm256_setzero_si256(), yg1_im);

	yv0_re = fxr_half_x4(_mm256_add_epi64(yt0_re, yt1_re));
	yv0_im = fxr_half_x4(_mm256_add_epi64(yt0_im, yt1_im));
	yv1_re = fxr_half_x4(_mm256_sub_epi64(yt0_re, yt1_re));
	yv1_im = fxr_half_x4(_mm256_sub_epi64(yt0_im, yt1_im));
	fxc_mul_x4(&yv1_re, &yv1_im, yv1_re, yv1_im, yg1_re, yg1_im);

	/*
	 * v0: 0:4:2:6
	 * v1: 1:5:3:7
	 * combine 0/2 and 1/3 with gm[k+0]
	 * combine 4/6 and 5/7 with gm[k+1]
	 */

	/* yt0 <- 0:4:1:5
	   yt1 <- 2:6:3:7 */
	yt0_re = _mm256_permute2x128_si256(yv0_re, yv1_re, 0x20);
	yt0_im = _mm256_permute2x128_si256(yv0_im, yv1_im, 0x20);
	yt1_re = _mm256_permute2x128_si256(yv0_re, yv1_re, 0x31);
	yt1_im = _mm256_permute2x128_si256(yv0_im, yv1_im, 0x31);

	/* yg0 <- gm0:gm1:gm0:gm1 */
	__m256i yg0 = _mm256_loadu_si256((const __m256i *)(GM_TAB + k));
	__m256i yg0_re = _mm256_permute4x64_epi64(yg0, 0x88);
	__m256i yg0_im = _mm256_permute4x64_epi64(yg0, 0xDD);
	yg0_im = _mm256_sub_epi64(_mm256_setzero_si256(), yg0_im);

	yv0_re = fxr_half_x4(_mm256_add_epi64(yt0_re, yt1_re));
	yv0_im = fxr_half_x4(_mm256_add_epi64(yt0_im, yt1_im));
	yv1_re = fxr_half_x4(_mm256_sub_epi64(yt0_re, yt1_re));
	yv1_im = fxr_half_x4(_mm256_sub_epi64(yt0_im, yt1_im));
	fxc_mul_x4(&yv1_re, &yv1_im, yv1_re, yv1_im, yg0_re, yg0_im);

	/*
	 * Reorder into 0:1:2:3 and 4:5:6:7
	 */
	yt0_re = _mm256_unpacklo_epi64(yv0_re, yv1_re);
	yt0_im = _mm256_unpacklo_epi64(yv0_im, yv1_im);
	yt1_re = _mm256_unpackhi_epi64(yv0_re, yv1_re);
	yt1_im = _mm256_unpackhi_epi64(yv0_im, yv1_im);
	yv0_re = _mm256_permute4x64_epi64(yt0_re, 0xD8);
	yv0_im = _mm256_permute4x64_epi64(yt0_im, 0xD8);
	yv1_re = _mm256_permute4x64_epi64(yt1_re, 0xD8);
	yv1_im = _mm256_permute4x64_epi64(yt1_im, 0xD8);

	*ya0_re = yv0_re;
	*ya0_im = yv0_im;
	*ya1_re = yv1_re;
	*ya1_im = yv1_im;
}
#endif // NTRUGEN_AVX2

/* see ng_inner.h */
TARGET_AVX2
void
vect_iFFT(unsigned logn, fxr *f)
{
	size_t hn = (size_t)1 << (logn - 1);
	size_t ht = 1;
#if NTRUGEN_AVX2
	if (logn >= 4) {
		size_t m1 = hn >> 1;
		size_t hm1 = m1 >> 1;
		for (size_t i = 0; i < hm1; i += 2) {
			__m256i ya0_re = _mm256_loadu_si256(
				(const __m256i *)(f + (i << 2) + 0));
			__m256i ya1_re = _mm256_loadu_si256(
				(const __m256i *)(f + (i << 2) + 4));
			__m256i ya0_im = _mm256_loadu_si256(
				(const __m256i *)(f + hn + (i << 2) + 0));
			__m256i ya1_im = _mm256_loadu_si256(
				(const __m256i *)(f + hn + (i << 2) + 4));
			fxp_iFFT4(&ya0_re, &ya1_re, &ya0_im, &ya1_im, m1 + i);
			_mm256_storeu_si256(
				(__m256i *)(f + (i << 2) + 0), ya0_re);
			_mm256_storeu_si256(
				(__m256i *)(f + (i << 2) + 4), ya1_re);
			_mm256_storeu_si256(
				(__m256i *)(f + hn + (i << 2) + 0), ya0_im);
			_mm256_storeu_si256(
				(__m256i *)(f + hn + (i << 2) + 4), ya1_im);
		}
		ht = 4;

		for (unsigned lm = logn - 3; lm > 0; lm --) {
			size_t m = (size_t)1 << lm;
			size_t t = ht << 1;
			size_t j0 = 0;
			size_t hm = m >> 1;
			for (size_t i = 0; i < hm; i ++) {
				fxc s = GM_TAB[m + i];
				__m256i ys_re = _mm256_set1_epi64x(s.re.v);
				__m256i ys_im = _mm256_set1_epi64x(-s.im.v);
				for (size_t j = j0; j < j0 + ht; j += 4) {
					__m256i ya_re = _mm256_loadu_si256(
						(__m256i *)(f + j));
					__m256i ya_im = _mm256_loadu_si256(
						(__m256i *)(f + j + hn));
					__m256i yb_re = _mm256_loadu_si256(
						(__m256i *)(f + j + ht));
					__m256i yb_im = _mm256_loadu_si256(
						(__m256i *)(f + j + ht + hn));
					__m256i yc_re = fxr_half_x4(
						_mm256_add_epi64(ya_re, yb_re));
					__m256i yc_im = fxr_half_x4(
						_mm256_add_epi64(ya_im, yb_im));
					__m256i yd_re = fxr_half_x4(
						_mm256_sub_epi64(ya_re, yb_re));
					__m256i yd_im = fxr_half_x4(
						_mm256_sub_epi64(ya_im, yb_im));
					fxc_mul_x4(&yd_re, &yd_im,
						yd_re, yd_im, ys_re, ys_im);
					_mm256_storeu_si256(
						(__m256i *)(f + j),
						yc_re);
					_mm256_storeu_si256(
						(__m256i *)(f + j + hn),
						yc_im);
					_mm256_storeu_si256(
						(__m256i *)(f + j + ht),
						yd_re);
					_mm256_storeu_si256(
						(__m256i *)(f + j + ht + hn),
						yd_im);
				}
				j0 += t;
			}
			ht = t;
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (unsigned lm = logn - 1; lm > 0; lm --) {
		size_t m = (size_t)1 << lm;
		size_t t = ht << 1;
		size_t j0 = 0;
		size_t hm = m >> 1;
		for (size_t i = 0; i < hm; i ++) {
			fxc s = fxc_conj(GM_TAB[m + i]);
			for (size_t j = j0; j < j0 + ht; j ++) {
				fxc x, y;
				x.re = f[j];
				x.im = f[j + hn];
				y.re = f[j + ht];
				y.im = f[j + ht + hn];
				fxc z1 = fxc_half(fxc_add(x, y));
				f[j] = z1.re;
				f[j + hn] = z1.im;
				fxc z2 = fxc_mul(s, fxc_half(fxc_sub(x, y)));
				f[j + ht] = z2.re;
				f[j + ht + hn] = z2.im;
			}
			j0 += t;
		}
		ht = t;
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_set(unsigned logn, fxr *d, const int8_t *f)
{
	size_t n = (size_t)1 << logn;
#if NTRUGEN_AVX2
	if (logn >= 4) {
		for (size_t u = 0; u < n; u += 16) {
			__m128i xf = _mm_loadu_si128((__m128i *)(f + u));
			__m256i ya0 = _mm256_cvtepi8_epi64(xf);
			__m256i ya1 = _mm256_cvtepi8_epi64(
				_mm_bsrli_si128(xf, 4));
			__m256i ya2 = _mm256_cvtepi8_epi64(
				_mm_bsrli_si128(xf, 8));
			__m256i ya3 = _mm256_cvtepi8_epi64(
				_mm_bsrli_si128(xf, 12));
			_mm256_storeu_si256((__m256i *)(d + u + 0),
				_mm256_slli_epi64(ya0, 32));
			_mm256_storeu_si256((__m256i *)(d + u + 4),
				_mm256_slli_epi64(ya1, 32));
			_mm256_storeu_si256((__m256i *)(d + u + 8),
				_mm256_slli_epi64(ya2, 32));
			_mm256_storeu_si256((__m256i *)(d + u + 12),
				_mm256_slli_epi64(ya3, 32));
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < n; u ++) {
		d[u] = fxr_of(f[u]);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_add(unsigned logn, fxr *restrict a, const fxr *restrict b)
{
	size_t n = (size_t)1 << logn;
#if NTRUGEN_AVX2
	if (logn >= 2) {
		for (size_t u = 0; u < n; u += 4) {
			__m256i ya = _mm256_loadu_si256((__m256i *)(a + u));
			__m256i yb = _mm256_loadu_si256((__m256i *)(b + u));
			__m256i yd = _mm256_add_epi64(ya, yb);
			_mm256_storeu_si256((__m256i *)(a + u), yd);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < n; u ++) {
		a[u] = fxr_add(a[u], b[u]);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_mul_realconst(unsigned logn, fxr *a, fxr c)
{
	size_t n = (size_t)1 << logn;
#if NTRUGEN_AVX2
	if (logn >= 2) {
		__m256i yc = _mm256_set1_epi64x(c.v);
		for (size_t u = 0; u < n; u += 4) {
			__m256i ya = _mm256_loadu_si256((__m256i *)(a + u));
			__m256i yd = fxr_mul_x4(ya, yc);
			_mm256_storeu_si256((__m256i *)(a + u), yd);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < n; u ++) {
		a[u] = fxr_mul(a[u], c);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_mul2e(unsigned logn, fxr *a, unsigned e)
{
	size_t n = (size_t)1 << logn;
#if NTRUGEN_AVX2
	if (logn >= 2) {
		__m256i ye = _mm256_set1_epi64x(e);
		for (size_t u = 0; u < n; u += 4) {
			__m256i ya = _mm256_loadu_si256((__m256i *)(a + u));
			ya = _mm256_sllv_epi64(ya, ye);
			_mm256_storeu_si256((__m256i *)(a + u), ya);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < n; u ++) {
		a[u] = fxr_mul2e(a[u], e);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_mul_fft(unsigned logn, fxr *restrict a, const fxr *restrict b)
{
	size_t hn = (size_t)1 << (logn - 1);
#if NTRUGEN_AVX2
	if (logn >= 3) {
		for (size_t u = 0; u < hn; u += 4) {
			__m256i ya_re = _mm256_loadu_si256(
				(const __m256i *)(a + u));
			__m256i ya_im = _mm256_loadu_si256(
				(const __m256i *)(a + u + hn));
			__m256i yb_re = _mm256_loadu_si256(
				(const __m256i *)(b + u));
			__m256i yb_im = _mm256_loadu_si256(
				(const __m256i *)(b + u + hn));
			__m256i yd_re, yd_im;
			fxc_mul_x4(&yd_re, &yd_im, ya_re, ya_im, yb_re, yb_im);
			_mm256_storeu_si256((__m256i *)(a + u), yd_re);
			_mm256_storeu_si256((__m256i *)(a + u + hn), yd_im);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < hn; u ++) {
		fxc x, y;
		x.re = a[u];
		x.im = a[u + hn];
		y.re = b[u];
		y.im = b[u + hn];
		fxc z = fxc_mul(x, y);
		a[u] = z.re;
		a[u + hn] = z.im;
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_adj_fft(unsigned logn, fxr *a)
{
	size_t hn = (size_t)1 << (logn - 1);
	size_t n = (size_t)1 << logn;
#if NTRUGEN_AVX2
	if (logn >= 3) {
		for (size_t u = hn; u < n; u += 4) {
			__m256i y = _mm256_loadu_si256((__m256i *)(a + u));
			y = _mm256_sub_epi64(_mm256_setzero_si256(), y);
			_mm256_storeu_si256((__m256i *)(a + u), y);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = hn; u < n; u ++) {
		a[u] = fxr_neg(a[u]);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_mul_autoadj_fft(unsigned logn, fxr *restrict a, const fxr *restrict b)
{
	size_t hn = (size_t)1 << (logn - 1);
#if NTRUGEN_AVX2
	if (logn >= 3) {
		for (size_t u = 0; u < hn; u += 4) {
			__m256i ya_re = _mm256_loadu_si256(
				(__m256i *)(a + u));
			__m256i ya_im = _mm256_loadu_si256(
				(__m256i *)(a + u + hn));
			__m256i yb = _mm256_loadu_si256(
				(__m256i *)(b + u));
			_mm256_storeu_si256((__m256i *)(a + u),
				fxr_mul_x4(ya_re, yb));
			_mm256_storeu_si256((__m256i *)(a + u + hn),
				fxr_mul_x4(ya_im, yb));
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < hn; u ++) {
		a[u] = fxr_mul(a[u], b[u]);
		a[u + hn] = fxr_mul(a[u + hn], b[u]);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_div_autoadj_fft(unsigned logn, fxr *restrict a, const fxr *restrict b)
{
	size_t hn = (size_t)1 << (logn - 1);
#if NTRUGEN_AVX2
	if (logn >= 3) {
		for (size_t u = 0; u < hn; u += 4) {
			__m256i ya_re = _mm256_loadu_si256(
				(const __m256i *)(a + u));
			__m256i ya_im = _mm256_loadu_si256(
				(const __m256i *)(a + u + hn));
			__m256i yb = _mm256_loadu_si256(
				(const __m256i *)(b + u));
			ya_re = fxr_div_x4(ya_re, yb);
			ya_im = fxr_div_x4(ya_im, yb);
			_mm256_storeu_si256((__m256i *)(a + u), ya_re);
			_mm256_storeu_si256((__m256i *)(a + u + hn), ya_im);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < hn; u ++) {
		a[u] = fxr_div(a[u], b[u]);
		a[u + hn] = fxr_div(a[u + hn], b[u]);
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_norm_fft(unsigned logn, fxr *restrict d,
	const fxr *restrict a, const fxr *restrict b)
{
	size_t hn = (size_t)1 << (logn - 1);
#if NTRUGEN_AVX2
	if (logn >= 3) {
		for (size_t u = 0; u < hn; u += 4) {
			__m256i ya_re = _mm256_loadu_si256(
				(const __m256i *)(a + u));
			__m256i ya_im = _mm256_loadu_si256(
				(const __m256i *)(a + u + hn));
			__m256i yb_re = _mm256_loadu_si256(
				(const __m256i *)(b + u));
			__m256i yb_im = _mm256_loadu_si256(
				(const __m256i *)(b + u + hn));
			__m256i y0 = fxr_sqr_x4(ya_re);
			__m256i y1 = fxr_sqr_x4(ya_im);
			__m256i y2 = fxr_sqr_x4(yb_re);
			__m256i y3 = fxr_sqr_x4(yb_im);
			__m256i yd = _mm256_add_epi64(
				_mm256_add_epi64(y0, y1),
				_mm256_add_epi64(y2, y3));
			_mm256_storeu_si256((__m256i *)(d + u), yd);
		}
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < hn; u ++) {
		d[u] = fxr_add(
			fxr_add(fxr_sqr(a[u]), fxr_sqr(a[u + hn])),
			fxr_add(fxr_sqr(b[u]), fxr_sqr(b[u + hn])));
	}
}

/* see ng_inner.h */
TARGET_AVX2
void
vect_invnorm_fft(unsigned logn, fxr *restrict d,
	const fxr *restrict a, const fxr *restrict b, unsigned e)
{
	size_t hn = (size_t)1 << (logn - 1);
	fxr fe = fxr_of((int32_t)1 << e);
#if NTRUGEN_AVX2
	if (logn >= 3) {
		__m256i yfe = _mm256_set1_epi64x(fe.v);
		for (size_t u = 0; u < hn; u += 4) {
			__m256i ya_re = _mm256_loadu_si256(
				(const __m256i *)(a + u));
			__m256i ya_im = _mm256_loadu_si256(
				(const __m256i *)(a + u + hn));
			__m256i yb_re = _mm256_loadu_si256(
				(const __m256i *)(b + u));
			__m256i yb_im = _mm256_loadu_si256(
				(const __m256i *)(b + u + hn));
			__m256i y0 = fxr_sqr_x4(ya_re);
			__m256i y1 = fxr_sqr_x4(ya_im);
			__m256i y2 = fxr_sqr_x4(yb_re);
			__m256i y3 = fxr_sqr_x4(yb_im);
			__m256i yz = _mm256_add_epi64(
				_mm256_add_epi64(y0, y1),
				_mm256_add_epi64(y2, y3));
			__m256i yd = fxr_div_x4(yfe, yz);
			_mm256_storeu_si256((__m256i *)(d + u), yd);
		}
		return;
	}
#endif // NTRUGEN_AVX2
	for (size_t u = 0; u < hn; u ++) {
		fxr z = fxr_add(
			fxr_add(fxr_sqr(a[u]), fxr_sqr(a[u + hn])),
			fxr_add(fxr_sqr(b[u]), fxr_sqr(b[u + hn])));
		d[u] = fxr_div(fe, z);
	}
}
